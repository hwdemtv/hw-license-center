# 项目深度风险评估与改进路线图 (Roadmap & Risk Assessment)

根据对 `hw-license-center` 的源码审计与部署流程分析，以下是更细粒度的待改进项、潜在风险及优化建议。

---

## 1. 潜在风险 (Potential Risks)

### 1.1 数据安全与可靠性
*   **[中风险] 缺乏自动化备份**：在 VPS 模式下，`local.db` 存储在磁盘空间，若发生硬件故障或误删，数据将不可恢复。
*   **[低风险] SQLite 并发写入瓶颈**：虽然开启了 WAL 模式提速，但 SQLite 的架构决定了同时只能有一个写事务。对于超高频的 Webhook 回调挤压，在高并发场景下可能触发 `SQLITE_BUSY`。
*   **[低风险] D1 边缘一致性**：Cloudflare D1 仍处于快速迭代期，虽然目前稳定，但边缘节点的极速同步机制在极端网络波动下可能存在极短时间的读写不一致。

### 1.2 安全防范
*   **[中风险] 秘钥管理风险**：`ADMIN_SECRET` 与 `JWT_SECRET` 目前依赖环境变量。若服务器被攻破导致 `.env` 泄露，整个授权系统将瞬间瘫痪。
*   **[中风险] 客户端指纹伪造**：目前的设备防刷依赖客户端主动上报信息。由于客户端环境受用户控制，高级黑客可以通过模拟硬件信息欺骗服务器，指纹增强 (Phase 22b) 只能提高门槛，无法 100% 杜绝。

---

## 2. 技术债及待改进项 (Technical Debt)

### 2.1 目录结构与维护
*   **遗留脚本清理**：根目录存在的 20 多个 `fix_*.cjs` 等脚本是一次性操作的产物。
    *   *建议*：建立 `scripts/maintenance/` 目录进行归档，保持根目录整洁。
*   **前端 HTML 耦合**：目前的 `admin.html` 与 `portal.html` 是硬编码在代码或单独注入的 TS 字符串。
    *   *改进*：引入轻量级模板引擎或将 HTML 作为外部 Assets 编译时注入。

### 2.2 代码质量
*   **类型安全**：路由层（routes）中仍存在少量 `any` 类型声明，尤其是处理数据库返回结果时。这在长期维护或重构中可能埋下隐患。
*   **错误处理一致性**：虽然有了 `error-reporter`，但部分旧路由中仍有显式的 `try-catch` 且没有记录详细上下文。

---

## 3. 未来优化方向 (Roadmap)

### 3.1 稳定与便捷性升级
*   **本地自动化离线包导出**：虽然有数据库，但定期导出包含活跃卡密的 JSON/CSV 快照到本地（或云端 R2），可在极端灾难下快速手动恢复业务。
*   **一键式本地开发环境搭建脚本**：更简单地初始化 `local.db` 和注入个人常用的 SystemConfig，方便在多台个人设备间迁移开发环境。

### 3.2 自动化运维 (重点)
*   **自动化备份脚本 (推荐级别提升)**：为 VPS 环境补全 `cron` 脚本，定期将 `local.db` 备份至 R2 或 S3 存储桶。这是个人使用最核心的兜底。
*   **极简状态页**：为自己提供一个极简的静态 Status 页面，实时展示 Worker 是否在线、API 延迟及证书过期情况。

### 3.3 大模型与 AI 能力 (Phase 28 - 已部分实现)
*   **[已完成] 基础 AI BFF 网关**：现已实现 JWT 鉴权的 AI 大模型请求代理、流透传与逐用户的独立每日限额管理。
*   **[中远期] 多模型路由支持**：未来可支持配置多个大模型厂商 API（如 OpenAI、Anthropic、智谱），按优先级或价格自动路由降级。

### 3.3 业务增强
*   **灰度/区域策略**：根据请求 IP 的地理位置，实现区域化的验证限制（例如禁止某些异常区域的解绑请求）。
*   **多维度统计报表**：在管理后台增加可视化图表，展示激活率走势、卡密过期预警以及各产品的设备分布情况。

---

## 💡 优先执行建议 (Action Items)
1.  **立刻**：迁移并清理根目录历史脚本。
2.  **短期**：为 VPS 环境实现简单的数据库冷备份逻辑。
3.  **中期**：按 `device-fingerprint-guide.md` 实现第一阶段指纹比对。
