export const adminHtml = "<!DOCTYPE html>\n<html lang=\"zh-CN\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>äº’ä¸ºå¡å¯†ä¸­å¿ƒ - å¼€å‘è€…æ§åˆ¶å° </title>\n  <style>\n    :root {\n      --bg-color: #0d1117;\n      --panel-bg: #161b22;\n      --card-bg: #21262d;\n      --border-color: #30363d;\n      --text-main: #8b949e;\n      --text-bright: #c9d1d9;\n      --accent: #58a6ff;\n      --accent-glow: rgba(88, 166, 255, 0.15);\n      --success: #3fb950;\n      --warning: #d29922;\n      --danger: #f85149;\n      --indigo: #5385ff;\n    }\n\n    body {\n      margin: 0;\n      font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Helvetica, Arial, sans-serif;\n      background: var(--bg-color);\n      color: var(--text-bright);\n      line-height: 1.6;\n    }\n\n    .container {\n      max-width: 1100px;\n      margin: 0 auto;\n      padding: 40px 20px;\n    }\n\n    /* Header & Stats */\n    .header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      margin-bottom: 30px;\n    }\n\n    .header-title {\n      display: flex;\n      align-items: center;\n      gap: 12px;\n    }\n\n    .header-title h1 {\n      font-size: 20px;\n      font-weight: 600;\n      margin: 0;\n    }\n\n    .stats-grid {\n      display: grid;\n      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n      gap: 16px;\n      margin-bottom: 24px;\n    }\n\n    .stat-card {\n      background: var(--panel-bg);\n      border: 1px solid var(--border-color);\n      padding: 20px;\n      border-radius: 12px;\n    }\n\n    .stat-label {\n      font-size: 13px;\n      color: var(--text-main);\n      margin-bottom: 8px;\n    }\n\n    .stat-value {\n      font-size: 24px;\n      font-weight: 700;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    /* Tabs */\n    .tabs {\n      display: flex;\n      gap: 8px;\n      margin-bottom: 24px;\n      border-bottom: 1px solid var(--border-color);\n    }\n\n    .tab {\n      padding: 12px 20px;\n      cursor: pointer;\n      color: var(--text-main);\n      font-weight: 500;\n      border-bottom: 2px solid transparent;\n      transition: 0.2s;\n      position: relative;\n    }\n\n    .tab:hover {\n      color: var(--text-bright);\n    }\n\n    .tab.active {\n      color: var(--accent);\n      border-bottom-color: var(--accent);\n    }\n\n    .section {\n      display: none;\n    }\n\n    .section.active {\n      display: block;\n    }\n\n    /* Forms & Inputs */\n    .card {\n      background: var(--panel-bg);\n      border: 1px solid var(--border-color);\n      border-radius: 12px;\n      padding: 24px;\n      margin-bottom: 24px;\n    }\n\n    .form-grid {\n      display: grid;\n      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));\n      gap: 20px;\n      margin-bottom: 20px;\n    }\n\n    .form-group label {\n      display: block;\n      font-size: 13px;\n      font-weight: 500;\n      margin-bottom: 8px;\n      color: var(--text-main);\n    }\n\n    input,\n    select {\n      width: 100%;\n      padding: 10px 12px;\n      background: #0d1117;\n      border: 1px solid var(--border-color);\n      border-radius: 6px;\n      color: var(--text-bright);\n      outline: none;\n      transition: 0.2s;\n      box-sizing: border-box;\n    }\n\n    input:focus {\n      border-color: var(--accent);\n      box-shadow: 0 0 0 3px var(--accent-glow);\n    }\n\n    button {\n      padding: 10px 20px;\n      border-radius: 6px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: 0.2s;\n      border: 1px solid transparent;\n      font-size: 14px;\n      display: inline-flex;\n      align-items: center;\n      justify-content: center;\n      gap: 6px;\n    }\n\n    button.primary {\n      background: var(--indigo);\n      color: white;\n    }\n\n    button.primary:hover {\n      opacity: 0.9;\n    }\n\n    button.secondary {\n      background: #21262d;\n      border-color: var(--border-color);\n      color: var(--text-bright);\n    }\n\n    button.secondary:hover {\n      background: #30363d;\n    }\n\n    button.danger {\n      background: transparent;\n      color: var(--danger);\n      border-color: var(--danger);\n    }\n\n    button.danger:hover {\n      background: var(--danger);\n      color: white;\n    }\n\n    /* List Layout for Licenses */\n    .lic-list {\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n      margin-top: 10px;\n    }\n\n    .lic-row {\n      background: var(--panel-bg);\n      border: 1px solid var(--border-color);\n      border-radius: 8px;\n      padding: 12px 16px;\n      display: grid;\n      grid-template-columns: 2fr 3fr 1fr 150px;\n      gap: 16px;\n      align-items: center;\n      transition: 0.2s;\n    }\n\n    .lic-row:hover {\n      border-color: var(--accent);\n      background: #1c2128;\n    }\n\n    .lic-header {\n      display: grid;\n      grid-template-columns: 2fr 3fr 1fr 150px;\n      gap: 16px;\n      padding: 0 16px 10px 16px;\n      font-size: 13px;\n      font-weight: 600;\n      color: var(--text-main);\n    }\n\n    @media(max-width: 800px) {\n      .lic-row {\n        grid-template-columns: 1fr;\n        align-items: start;\n      }\n\n      .lic-header {\n        display: none;\n      }\n    }\n\n    .badge {\n      padding: 2px 8px;\n      border-radius: 2em;\n      font-size: 12px;\n      font-weight: 600;\n    }\n\n    .badge-success {\n      background: rgba(63, 185, 80, 0.1);\n      color: var(--success);\n      border: 1px solid rgba(63, 185, 80, 0.2);\n    }\n\n    .badge-warning {\n      background: rgba(210, 153, 34, 0.1);\n      color: var(--warning);\n      border: 1px solid rgba(210, 153, 34, 0.2);\n    }\n\n    .badge-danger {\n      background: rgba(248, 81, 73, 0.1);\n      color: var(--danger);\n      border: 1px solid rgba(248, 81, 73, 0.2);\n    }\n\n    /* Modal */\n    .modal-overlay {\n      position: fixed;\n      inset: 0;\n      background: rgba(0, 0, 0, 0.6);\n      display: none;\n      align-items: center;\n      justify-content: center;\n      z-index: 2000;\n      backdrop-filter: blur(4px);\n    }\n\n    .modal-overlay.active {\n      display: flex;\n    }\n\n    .modal-content {\n      background: var(--panel-bg);\n      border: 1px solid var(--border-color);\n      border-radius: 12px;\n      padding: 24px;\n      width: 400px;\n      max-width: 90vw;\n    }\n\n    .modal-header {\n      font-size: 18px;\n      font-weight: 600;\n      margin-bottom: 16px;\n      color: var(--text-bright);\n    }\n\n    .modal-body {\n      margin-bottom: 24px;\n      color: var(--text-main);\n      font-size: 14px;\n    }\n\n    .modal-footer {\n      display: flex;\n      justify-content: flex-end;\n      gap: 12px;\n    }\n\n    /* Auth Overlay */\n    #adminAuth {\n      position: fixed;\n      inset: 0;\n      background: var(--bg-color);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      z-index: 1000;\n    }\n\n    .login-card {\n      width: 340px;\n      padding: 32px;\n      background: var(--panel-bg);\n      border: 1px solid var(--border-color);\n      border-radius: 12px;\n      text-align: center;\n    }\n\n    /* Custom Dropdown */\n    .dropdown-container {\n      position: relative;\n      width: 100%;\n    }\n\n    .custom-dropdown {\n      position: absolute;\n      top: calc(100% + 4px);\n      left: 0;\n      right: 0;\n      background: var(--panel-bg);\n      border: 1px solid var(--border-color);\n      border-radius: 8px;\n      z-index: 100;\n      max-height: 240px;\n      overflow-y: auto;\n      display: none;\n      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);\n    }\n\n    .custom-dropdown.active {\n      display: block;\n      animation: dropDownFade 0.2s ease-out;\n    }\n\n    @keyframes dropDownFade {\n      from {\n        opacity: 0;\n        transform: translateY(-10px);\n      }\n\n      to {\n        opacity: 1;\n        transform: translateY(0);\n      }\n    }\n\n    .dropdown-item {\n      padding: 10px 12px;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      cursor: pointer;\n      font-size: 13px;\n      transition: 0.2s;\n    }\n\n    .dropdown-item:hover {\n      background: #1c2128;\n      color: var(--accent);\n    }\n\n    .dropdown-item.remove-btn {\n      opacity: 0;\n      width: 24px;\n      height: 24px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      border-radius: 4px;\n      color: var(--text-main);\n      transition: 0.2s;\n    }\n\n    .dropdown-item:hover .remove-btn {\n      opacity: 1;\n    }\n\n    .dropdown-item.remove-btn:hover {\n      background: rgba(248, 81, 73, 0.1);\n      color: var(--danger);\n    }\n\n    .custom-dropdown::-webkit-scrollbar {\n      width: 6px;\n    }\n\n    .custom-dropdown::-webkit-scrollbar-thumb {\n      background: var(--border-color);\n      border-radius: 10px;\n    }\n\n    /* åˆ†é¡µæ§ä»¶æ ·å¼ */\n    .pagination {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      gap: 12px;\n      margin-top: 24px;\n      padding: 16px 0;\n      border-top: 1px solid var(--border-color);\n    }\n\n    .pagination button {\n      padding: 6px 14px;\n      font-size: 13px;\n    }\n\n    .pagination .page-info {\n      font-size: 13px;\n      color: var(--text-main);\n      background: var(--card-bg);\n      padding: 6px 12px;\n      border-radius: 6px;\n      border: 1px solid var(--border-color);\n    }\n\n    /* æ‰¹é‡æ“ä½œæ‚¬æµ®æ¡ */\n    .batch-bar {\n      position: fixed;\n      bottom: 20px;\n      left: 50%;\n      transform: translateX(-50%) translateY(100px);\n      background: var(--panel-bg);\n      border: 1px solid var(--border-color);\n      padding: 12px 24px;\n      border-radius: 12px;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n      display: flex;\n      gap: 12px;\n      align-items: center;\n      transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n      opacity: 0;\n      pointer-events: none;\n      z-index: 100;\n    }\n\n    .batch-bar.active {\n      transform: translateX(-50%) translateY(0);\n      opacity: 1;\n      pointer-events: auto;\n    }\n\n    .batch-bar button {\n      padding: 6px 12px;\n      font-size: 13px;\n    }\n\n    .batch-count {\n      background: var(--accent);\n      color: var(--bg-color);\n      font-weight: bold;\n      padding: 2px 8px;\n      border-radius: 10px;\n      margin-right: 12px;\n    }\n\n    .custom-checkbox {\n      width: 16px;\n      height: 16px;\n      cursor: pointer;\n    }\n  </style>\n\n<body>\n\n  <div id=\"appModal\" class=\"modal-overlay\">\n    <div class=\"modal-content\">\n      <div id=\"modalTitle\" class=\"modal-header\"> æç¤º </div>\n      <div id=\"modalBody\" class=\"modal-body\"> </div>\n      <div id=\"modalInputs\" class=\"form-grid\" style=\"display:none; margin-bottom: 20px;\"> </div>\n      <div class=\"modal-footer\">\n        <button class=\"secondary\" id=\"modalBtnCancel\" onclick=\"closeModal()\"> å–æ¶ˆ </button>\n        <button class=\"primary\" id=\"modalBtnConfirm\"> ç¡®å®š </button>\n      </div>\n    </div>\n  </div>\n\n  <div id=\"adminAuth\">\n    <div class=\"login-card\">\n      <h2 style=\"margin-top:0; color:var(--text-bright)\">ğŸ”‘ èº«ä»½éªŒè¯ </h2>\n      <p style=\"color:var(--text-main); font-size:14px; margin-bottom:24px;\"> è¾“å…¥ç®¡ç†å‘˜å¯†é’¥ä»¥è¿›å…¥æ§åˆ¶å° </p>\n      <div class=\"form-group\" style=\"text-align:left; position:relative;\">\n        <input type=\"password\" id=\"globalSecret\" placeholder=\"è¾“å…¥ Admin Secret...\" value=\"\" style=\"padding-right: 40px;\">\n        <span\n          onclick=\"const i=document.getElementById('globalSecret');if(i.type==='password'){i.type='text';this.innerText='ğŸ™ˆ'}else{i.type='password';this.innerText='ğŸ‘ï¸'}\"\n          style=\"position:absolute; right:12px; top:50%; transform:translateY(-50%); cursor:pointer; opacity:0.6; user-select:none;\">ğŸ‘ï¸</span>\n      </div>\n      <button class=\"primary\" style=\"width:100%; margin-top:16px;\" onclick=\"login()\"> è¿›å…¥æ§åˆ¶å° </button>\n    </div>\n  </div>\n\n  <div class=\"container\">\n    <div class=\"header\">\n      <div class=\"header-title\">\n        <div style=\"background:var(--indigo); padding:8px; border-radius:8px; display:flex;\">\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" stroke-width=\"2.5\"\n            stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\" />\n            <path d=\"M7 11V7a5 5 0 0 1 10 0v4\" />\n          </svg>\n        </div>\n        <h1> äº’ä¸ºå¡å¯†ä¸­å¿ƒ </h1>\n      </div>\n      <div style=\"display:flex; gap:8px;\">\n        <button class=\"secondary\" onclick=\"loadLicenses()\">ğŸ”„ åˆ·æ–°åˆ—è¡¨ </button>\n        <button class=\"secondary\" onclick=\"logout()\" style=\"color:var(--danger); border-color:rgba(255,100,100,0.3)\">ğŸšª\n          é€€å‡ºç™»å½• </button>\n      </div>\n    </div>\n\n    <div class=\"stats-grid\">\n      <div class=\"stat-card\">\n        <div class=\"stat-label\"> æ€»å¡å¯†æ•°(Keys) </div>\n        <div class=\"stat-value\" id=\"stat-total\"> -</div>\n      </div>\n      <div class=\"stat-card\">\n        <div class=\"stat-label\"> æ´»è·ƒä¸­(Active) </div>\n        <div class=\"stat-value\" id=\"stat-active\" style=\"color:var(--success)\"> -</div>\n      </div>\n      <div class=\"stat-card\">\n        <div class=\"stat-label\"> å·²åŠé”€(Revoked) </div>\n        <div class=\"stat-value\" id=\"stat-revoked\" style=\"color:var(--danger)\"> -</div>\n      </div>\n      <div class=\"stat-card\">\n        <div class=\"stat-label\"> ä¸´æœŸ / å·²è¿‡æœŸ(Sub) </div>\n        <div class=\"stat-value\" id=\"stat-expiring\" style=\"color:var(--warning)\"> -</div>\n      </div>\n    </div>\n\n    <div class=\"tabs\">\n      <div class=\"tab active\" onclick=\"switchTab('generate')\">âš¡ æé€Ÿç”Ÿå¡ </div>\n      <div class=\"tab\" onclick=\"switchTab('manage')\">ğŸ› ï¸ èµ„äº§ç®¡ç† </div>\n    </div>\n\n    <!--Tab: Generate-->\n    <div id=\"sec-generate\" class=\"section active\">\n      <div class=\"card\">\n        <div class=\"form-grid\">\n          <div class=\"form-group\">\n            <label>äº§å“çº¿æ ‡è¯†(Product ID) </label>\n            <div class=\"dropdown-container\">\n              <input type=\"text\" id=\"genProductId\" value=\"smartmp\" placeholder=\"è¾“å…¥ ID æˆ–ç‚¹å‡»é€‰æ‹©å†å²è®°å½•\" autocomplete=\"off\"\n                onfocus=\"showDropdown()\" oninput=\"updateProductHelpers()\">\n              <div id=\"productDropdown\" class=\"custom-dropdown\"> </div>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label>ç»‘å®šç”¨æˆ·å / å¤‡æ³¨(å¯é€‰) </label>\n            <input type=\"text\" id=\"genUserName\" placeholder=\"ä¾‹å¦‚: å®¢æˆ·åã€å†…éƒ¨è®¢å•å·...\">\n          </div>\n        </div>\n        <div class=\"form-grid\">\n          <div class=\"form-group\">\n            <label>æ¿€æ´»ç è®¾å¤‡é…é¢(Max Devices) </label>\n            <input type=\"number\" id=\"genMaxDevices\" value=\"2\" min=\"1\">\n          </div>\n          <div class=\"form-group\">\n            <label>åˆå§‹è®¢é˜…æœ‰æ•ˆæœŸ(å¤©æ•°, ç•™ç©ºä¸ºæ°¸ä¹…) </label>\n            <input type=\"number\" id=\"genDuration\" placeholder=\"ä¾‹å¦‚: 365, 30...\">\n          </div>\n          <div class=\"form-group\">\n            <label>æ‰¹é‡ç”Ÿæˆæ•°é‡ </label>\n            <input type=\"number\" id=\"genCount\" value=\"1\" min=\"1\" max=\"100\">\n          </div>\n        </div>\n        <button class=\"primary\" id=\"btnDoGen\" onclick=\"doGenerate()\" style=\"width:100%; margin-top:10px;\">âœ¨ ç«‹å³åˆ¶å¡å¹¶æ¿€æ´»è®¢é˜…\n        </button>\n\n        <div id=\"genResult\"\n          style=\"display:none; margin-top:24px; padding-top:24px; border-top:1px dashed var(--border-color);\">\n          <label style=\"color:var(--success); font-weight:600; margin-bottom:12px; display:block;\">âœ… ç”ŸæˆæˆåŠŸï¼Œè¯·å¤åˆ¶ä¿å­˜ï¼š</label>\n          <div id=\"genOutput\"\n            style=\"background:#0d1117; padding:16px; border-radius:8px; font-family:monospace; font-size:13px; margin-bottom:16px; white-space:pre-wrap; border:1px solid var(--border-color); color:var(--success);\">\n          </div>\n          <button class=\"secondary\" style=\"width:100%\" onclick=\"copyGenResult()\">ğŸ“‹ å¤åˆ¶å…¨éƒ¨å¡å¯†æ–‡æœ¬ </button>\n        </div>\n      </div>\n    </div>\n\n    <!--Tab: Manage-->\n    <div id=\"sec-manage\" class=\"section\">\n      <div class=\"search-bar\">\n        <div class=\"search-input-wrap\">\n          <input type=\"text\" id=\"keywordSearch\" placeholder=\"å¿«é€Ÿæœç´¢æ¿€æ´»ç ã€ç”¨æˆ·å...\" oninput=\"filterLocalList()\">\n        </div>\n        <div style=\"width:200px\">\n          <select id=\"filterProductId\" onchange=\"loadLicenses()\">\n            <option value=\"\"> æ‰€æœ‰äº§å“çº¿(Show All) </option>\n          </select>\n        </div>\n        <div\n          style=\"display:flex; flex-wrap:wrap; gap:16px; align-items:center; justify-content:space-between; margin-bottom:16px; margin-top:16px;\">\n          <div style=\"display:flex; gap:8px;\">\n            <button class=\"secondary\" onclick=\"exportExcel()\" title=\"å¯¼å‡ºé€‚åˆ Excel é˜…è¯»çš„æ˜ç»†è¡¨æ ¼\">ğŸ“Š å¯¼å‡º Excel </button>\n            <button class=\"secondary\" onclick=\"exportData()\" title=\"å¯¼å‡º JSON å¤‡ä»½ä»¥ç”¨äºè·¨ç«¯è¿ç§»\">ğŸ“¤ å¤‡ä»½ JSON </button>\n            <button class=\"secondary\" onclick=\"document.getElementById('importFile').click()\" title=\"é€šè¿‡ JSON æ¢å¤èµ„äº§\">ğŸ“¥\n              å¯¼å…¥è¿˜åŸ\n            </button>\n            <input type=\"file\" id=\"importFile\" accept=\".json\" style=\"display:none\" onchange=\"importData(event)\">\n          </div>\n          <div id=\"topPagination\"></div>\n        </div>\n      </div>\n\n      <!--é˜¶æ®µä¸€äºŒè¿‡æ¸¡ï¼šæš‚æ—¶ä¿ç•™ table å®¹å™¨åï¼Œä»¥ä¾¿ JS è¿˜èƒ½å¡«å……æ•°æ®ï¼Œä¸‹ä¸€é˜¶æ®µå°†å½»åº•æ”¹ä¸ºç½‘æ ¼å¡ç‰‡-->\n      <div id=\"licListContainer\">\n        <div class=\"table-container\">\n          <table id=\"licTable\">\n            <thead>\n              <tr>\n                <th>æ¿€æ´»ç (Key) </th>\n                <th> åŸºæœ¬ä¿¡æ¯ </th>\n                <th> å½“å‰è®¢é˜… </th>\n                <th> è®¾å¤‡ä½¿ç”¨ </th>\n                <th> å¿«æ·æ“ä½œ </th>\n              </tr>\n            </thead>\n            <tbody> </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- æ‰¹é‡æ“ä½œæ‚¬æµ®æ¡ -->\n  <div class=\"batch-bar\" id=\"batchBar\">\n    <div class=\"batch-count\" id=\"batchCountDisplay\">0</div>\n    <select id=\"batchActionSelect\"\n      style=\"background:#0d1117; color:#c9d1d9; border:1px solid #30363d; border-radius:6px; padding:6px 12px; font-size:13px; outline:none;\">\n      <option value=\"\" disabled selected>ğŸ‘‰ é€‰æ‹©æ‰¹é‡åŠ¨ä½œ...</option>\n      <optgroup label=\"åŸºç¡€æ•°æ®\">\n        <option value=\"revoke\">ğŸ”’ æ‰¹é‡åŠé”€</option>\n        <option value=\"restore\">ğŸ”“ æ‰¹é‡æ¢å¤</option>\n        <option value=\"delete\">ğŸ—‘ï¸ æ‰¹é‡å½»åº•åˆ é™¤</option>\n        <option value=\"set_user_name\">ğŸ“ æ‰¹é‡ä¿®æ”¹å¤‡æ³¨</option>\n        <option value=\"copy_keys\">ğŸ“‹ å¤åˆ¶é€‰ä¸­çš„æ¿€æ´»ç </option>\n      </optgroup>\n      <optgroup label=\"äº§å“ä¸è®¢é˜…\">\n        <option value=\"add_subscription\">ğŸš€ æ‰¹é‡ç»­è´¹ / åŠ äº§å“</option>\n        <option value=\"remove_subscription\">âŒ æ‰¹é‡ç§»é™¤äº§å“æƒé™</option>\n      </optgroup>\n      <optgroup label=\"è®¾å¤‡\">\n        <option value=\"unbind\">ğŸ“± æ‰¹é‡é‡Šæ”¾æ‰€æœ‰è®¾å¤‡</option>\n        <option value=\"set_max_devices\">ğŸ”¢ æ‰¹é‡ä¿®æ”¹è®¾å¤‡ä¸Šé™</option>\n      </optgroup>\n    </select>\n    <button class=\"primary\" onclick=\"executeBatch()\">ğŸš€ ç¡®å®šæ‰§è¡Œ</button>\n    <button class=\"secondary\" onclick=\"clearBatchSelection()\">æ¸…ç©ºå‹¾é€‰</button>\n  </div>\n\n  <script>\n    let ADMIN_SECRET = \"\";\n    let ALL_LICENSES = []; // æœ¬åœ°æ•°æ®ç¼“å­˜\n    let SET_SELECTED_KEYS = new Set(); // æ‰¹é‡é€‰ä¸­çš„ keys\n\n\n    // åˆ†é¡µçŠ¶æ€\n    let currentPage = 1;\n    let PAGE_SIZE = 20;  // æ¯é¡µæ˜¾ç¤ºæ¡æ•°\n    let PRODUCT_HISTORY = new Set(['smartmp']);\n\n    let modalResolve = null;\n\n    function showModal(options) {\n      return new Promise(resolve => {\n        document.getElementById('modalTitle').innerText = options.title || 'æç¤º';\n        document.getElementById('modalBody').innerHTML = options.message || '';\n\n        const inputsDiv = document.getElementById('modalInputs');\n        inputsDiv.innerHTML = '';\n        if (options.inputs) {\n          inputsDiv.style.display = 'grid';\n          let htmlInputs = '';\n          options.inputs.forEach((inp, i) => {\n            htmlInputs += '<div class=\"form-group\"><label>' + inp.label + '</label><input type=\"' + (inp.type || 'text') + '\" id=\"modalInp' + i + '\" value=\"' + (inp.value || '') + '\" placeholder=\"' + (inp.placeholder || '') + '\"></div>';\n          });\n          inputsDiv.innerHTML = htmlInputs;\n        } else {\n          inputsDiv.style.display = 'none';\n        }\n\n        const confirmBtn = document.getElementById('modalBtnConfirm');\n        confirmBtn.className = options.danger ? 'danger' : 'primary';\n        confirmBtn.innerText = options.confirmText || 'ç¡®å®š';\n\n        const cancelBtn = document.getElementById('modalBtnCancel');\n        if (options.type === 'alert') {\n          cancelBtn.style.display = 'none';\n        } else {\n          cancelBtn.style.display = 'inline-flex';\n        }\n\n        modalResolve = resolve;\n\n        confirmBtn.onclick = () => {\n          let result = true;\n          if (options.inputs) {\n            result = options.inputs.map((_, i) => document.getElementById('modalInp' + i).value);\n          }\n          closeModal(result);\n        };\n\n        document.getElementById('appModal').classList.add('active');\n      });\n    }\n\n    function closeModal(result = false) {\n      document.getElementById('appModal').classList.remove('active');\n      if (modalResolve) modalResolve(result);\n      modalResolve = null;\n    }\n\n    function login() {\n      const s = document.getElementById('globalSecret').value;\n      if (!s) return;\n      ADMIN_SECRET = s;\n      localStorage.setItem('hw_admin_secret', s);\n      document.getElementById('adminAuth').style.display = 'none';\n      loadLicenses();\n    }\n\n    function logout() {\n      ADMIN_SECRET = \"\";\n      localStorage.removeItem('hw_admin_secret');\n      document.getElementById('globalSecret').value = '';\n      document.getElementById('adminAuth').style.display = 'flex';\n      document.getElementById('licListContainer').innerHTML = '';\n      ALL_LICENSES = [];\n      updateStats();\n    }\n\n    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨å°è¯•ä»æœ¬åœ°ç¼“å­˜æ¢å¤ä¼šè¯\n    window.addEventListener('DOMContentLoaded', () => {\n      const savedSecret = localStorage.getItem('hw_admin_secret');\n      if (savedSecret) {\n        document.getElementById('globalSecret').value = savedSecret;\n        login();\n      }\n    });\n\n    // å›è½¦å¿«æ·ç™»å½•\n    document.getElementById('globalSecret').onkeyup = (e) => { if (e.key === 'Enter') login(); };\n\n    function switchTab(tab) {\n      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));\n      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));\n      const target = (event && event.target) ? event.target : document.querySelector('.tab[onclick*=\"' + tab + '\"]');\n      if (target) target.classList.add('active');\n      document.getElementById('sec-' + tab).classList.add('active');\n      if (tab === 'manage') loadLicenses();\n    }\n\n    // è®¡ç®—å¹¶æ›´æ–°é¡¶éƒ¨ç»Ÿè®¡æŒ‡æ ‡\n    function updateStats() {\n      const total = ALL_LICENSES.length;\n      const active = ALL_LICENSES.filter(l => l.status === 'active').length;\n      const revoked = ALL_LICENSES.filter(l => l.status === 'revoked').length;\n\n      // ä¸´æœŸè®¢é˜… (7å¤©å†…è¿‡æœŸ)\n      const now = new Date();\n      const SEVEN_DAYS = 7 * 24 * 60 * 60 * 1000;\n      const expiring = ALL_LICENSES.filter(l => {\n        if (!l.subscriptions) return false;\n        return l.subscriptions.some(s => {\n          if (!s.expires_at) return false;\n          const diff = new Date(s.expires_at) - now;\n          return diff > 0 && diff <= SEVEN_DAYS;\n        });\n      }).length;\n\n      document.getElementById('stat-total').innerText = total;\n      document.getElementById('stat-active').innerText = active;\n      document.getElementById('stat-revoked').innerText = revoked;\n      document.getElementById('stat-expiring').innerText = expiring;\n    }\n\n    // æ˜¾ç¤º/éšè—ä¸‹æ‹‰æ¡†\n    function showDropdown() {\n      document.getElementById('productDropdown').classList.add('active');\n      updateProductHelpers();\n    }\n    function hideDropdown() {\n      setTimeout(() => {\n        document.getElementById('productDropdown').classList.remove('active');\n      }, 200); // å»¶è¿Ÿå…³é—­ä»¥ä¾¿æ•è·ç‚¹å‡»\n    }\n\n    // ä»å†å²è®°å½•ä¸­ç‰©ç†ç§»é™¤æŸä¸ªäº§å“ ID\n    function removeFromHistory(e, id) {\n      if (e) e.stopPropagation(); // é˜²æ­¢è§¦å‘é€‰æ‹©\n      if (confirm('ç¡®å®šä»å†å²å»ºè®®ä¸­ç§»é™¤ \"' + id + '\" å—ï¼Ÿ')) {\n        PRODUCT_HISTORY.delete(id);\n        updateProductHelpers();\n      }\n    }\n\n    // ç”Ÿå¡åŒºé€‰æ‹©äº§å“ ID çš„è¾…åŠ©å‡½æ•°\n    function setGenProduct(val) {\n      document.getElementById('genProductId').value = val;\n      updateProductHelpers();\n      hideDropdown();\n    }\n\n    // æ›´æ–°äº§å“è¾…åŠ©å™¨ï¼ˆåŒ…æ‹¬ç­›é€‰ä¸‹æ‹‰å’Œè‡ªå®šä¹‰ç”Ÿå¡ä¸‹æ‹‰æ¡†ï¼‰\n    function updateProductHelpers() {\n      const filterSelect = document.getElementById('filterProductId');\n      const dropdown = document.getElementById('productDropdown');\n      const genInput = document.getElementById('genProductId');\n\n      // 1. åŒæ­¥å½“å‰æ‰€æœ‰å­˜é‡äº§å“åˆ°å†å²åº“\n      ALL_LICENSES.forEach(l => PRODUCT_HISTORY.add(l.product_id));\n\n      // 2. æ›´æ–°ç®¡ç†åˆ—è¡¨ä¸Šæ–¹çš„â€œç­›é€‰â€ä¸‹æ‹‰æ¡†\n      const currentFilter = filterSelect.value;\n      filterSelect.innerHTML = '<option value=\"\">æ‰€æœ‰äº§å“çº¿ (Show All)</option>';\n      [...PRODUCT_HISTORY].sort().forEach(p => {\n        const opt = document.createElement('option');\n        opt.value = p; opt.innerText = p;\n        filterSelect.appendChild(opt);\n      });\n      filterSelect.value = currentFilter;\n\n      // 3. æ›´æ–°ç”Ÿå¡åŒºçš„â€œè‡ªå®šä¹‰æœç´¢ä¸‹æ‹‰æ¡†â€\n      const searchVal = genInput.value.toLowerCase();\n      const matches = [...PRODUCT_HISTORY].filter(p => !searchVal || p.toLowerCase().includes(searchVal)).sort();\n\n      if (matches.length === 0) {\n        dropdown.innerHTML = '<div style=\"padding:12px; font-size:12px; color:var(--text-main); text-align:center;\">æœªæ‰¾åˆ°åŒ¹é…çš„å†å²è®°å½•</div>';\n      } else {\n        let listHtml = '';\n        matches.forEach(p => {\n          // ä½¿ç”¨æ›´ç®€æ´çš„å‡½æ•°è°ƒç”¨ï¼Œå¹¶ä½¿ç”¨ä¸‰çº§è½¬ä¹‰ä»¥é˜²è¯­æ³•å´©æºƒ\n          listHtml += '<div class=\"dropdown-item\" onclick=\"setGenProduct(\\\\\\'' + p + '\\\\\\')\">' +\n            '<span>' + p + '</span>' +\n            '<div class=\"remove-btn\" onclick=\"removeFromHistory(event, \\\\\\'' + p + '\\\\\\')\" title=\"ä»å†å²ä¸­ç§»é™¤\">âœ•</div>' +\n            '</div>';\n        });\n        dropdown.innerHTML = listHtml;\n      }\n    }\n\n    // ç‚¹å‡»å¤–éƒ¨è‡ªåŠ¨å…³é—­ä¸‹æ‹‰\n    document.addEventListener('click', (e) => {\n      if (!e.target.closest('.dropdown-container')) {\n        document.getElementById('productDropdown').classList.remove('active');\n      }\n    });\n\n    // æ¥å£åŠ è½½æ•°æ®\n    async function loadLicenses() {\n      const pId = document.getElementById('filterProductId').value;\n      const container = document.getElementById('licListContainer');\n      container.innerHTML = '<div style=\"text-align:center; padding:50px; color:var(--text-main)\">ğŸš€ æ­£åœ¨åŒæ­¥è¾¹ç¼˜æ•°æ®...</div>';\n\n      try {\n        const res = await fetch('/api/v1/auth/admin/licenses?product_id=' + pId, {\n          headers: { 'Authorization': 'Bearer ' + ADMIN_SECRET }\n        });\n        const data = await res.json();\n        if (!data.success) {\n          if (res.status === 401) {\n            logout();\n            showModal({ title: 'ä¼šè¯å¤±æ•ˆ', message: 'å¯†é’¥æ— æ•ˆæˆ–å·²æ›´æ”¹ï¼Œè¯·é‡æ–°è¾“å…¥', type: 'alert' });\n            return;\n          }\n          container.innerHTML = '<div style=\"padding:20px; color:var(--danger)\">âŒ è·å–å¤±è´¥: ' + data.msg + '</div>';\n          return;\n        }\n\n        ALL_LICENSES = data.data;\n        currentPage = 1; // é‡æ–°æ‹‰å–åé‡ç½®ä¸ºç¬¬ä¸€é¡µ\n        updateStats();\n        updateProductHelpers();\n        renderCards(ALL_LICENSES);\n      } catch (e) {\n        container.innerHTML = '<div style=\"padding:20px; color:var(--danger)\">âš ï¸ æ— æ³•è¿æ¥æœåŠ¡å™¨</div>';\n      }\n    }\n\n    // æ¸²æŸ“åˆ—è¡¨è§†å›¾å¸ƒå±€\n    function renderCards(list) {\n      const container = document.getElementById('licListContainer');\n      if (list.length === 0) {\n        container.innerHTML = '<div style=\"text-align:center; padding:50px; color:var(--text-main)\">ğŸ“­ æš‚æ— ç›¸å…³å¡å¯†æ•°æ®</div>';\n        return;\n      }\n\n      // è·å–æ‰€æœ‰ç»è¿‡è¿‡æ»¤åçš„å¡å¯† IDï¼Œä»¥ä¾¿å…¨é€‰ä½¿ç”¨\n      const currentFilteredKeys = list.map(l => l.license_key);\n\n      // æ£€æŸ¥æ˜¯å¦åœ¨å½“å‰åˆ—è¡¨å’Œé›†åˆä¸­å…¨é€‰äº†\n      const isAllChecked = list.length > 0 && list.every(l => SET_SELECTED_KEYS.has(l.license_key));\n\n      let html = '<div class=\"lic-list\">';\n      html += `\n    <div class=\"lic-header\" style=\"grid-template-columns: 30px 1.5fr 1.5fr 1fr 1fr;\">\n      <div><input type=\"checkbox\" class=\"custom-checkbox\" ${isAllChecked ? 'checked' : ''} onclick=\"toggleAllCheckboxes(this)\" title=\"å…¨é€‰å½“å‰åˆ—è¡¨\"></div>\n      <div>æˆæƒæ ‡è¯† & ä½¿ç”¨è€…</div>\n      <div>äº§å“æƒé™ä¸æœ‰æ•ˆæœŸ</div>\n      <div>åœ¨çº¿è®¾å¤‡</div>\n      <div style=\"text-align:right\">æ“ä½œ</div>\n    </div>\n  `;\n\n      const now = new Date();\n\n      // åˆ†é¡µè®¡ç®—\n      const totalItems = list.length;\n      const totalPages = Math.ceil(totalItems / PAGE_SIZE) || 1;\n      // é˜²å¾¡æ€§çº æ­£\n      if (currentPage > totalPages) currentPage = totalPages;\n      if (currentPage < 1) currentPage = 1;\n\n      const startIndex = (currentPage - 1) * PAGE_SIZE;\n      const endIndex = Math.min(startIndex + PAGE_SIZE, totalItems);\n      const pagedList = list.slice(startIndex, endIndex);\n\n      pagedList.forEach((lic) => {\n        // å‡†å¤‡è®¢é˜…çŠ¶æ€ HTML\n        let subHtml = '';\n        if (lic.subscriptions && lic.subscriptions.length > 0) {\n          subHtml = lic.subscriptions.map((s) => {\n            let text = 'æ°¸ ä¹…';\n            let cls = 'badge-success';\n            if (s.expires_at) {\n              const days = Math.ceil((new Date(s.expires_at) - now) / (86400000));\n              text = days > 0 ? 'å‰© ' + days + ' å¤©' : 'å·²è¿‡æœŸ';\n              cls = days > 7 ? 'badge-success' : (days > 0 ? 'badge-warning' : 'badge-danger');\n            }\n            return '<span class=\"badge ' + cls + '\" style=\"margin-right:4px;\">' + s.product_id + ': ' + text + '</span>';\n          }).join('');\n        } else {\n          subHtml = '<span style=\"color:var(--text-main); font-size:11px; font-style:italic\">æš‚æ— è®¢é˜…äº§å“</span>';\n        }\n\n        const isRevoked = lic.status === 'revoked';\n        const devicePct = Math.min(100, (lic.current_devices / lic.max_devices) * 100);\n\n        html += `\n      <div class=\"lic-row\" style=\"grid-template-columns: 30px 1.5fr 1.5fr 1fr 1fr;\">\n        <!-- Col 0: Checkbox -->\n        <div style=\"display:flex; align-items:center;\">\n          <input type=\"checkbox\" class=\"custom-checkbox row-checkbox\" value=\"${lic.license_key}\" ${SET_SELECTED_KEYS.has(lic.license_key) ? 'checked' : ''} onclick=\"toggleBatchItem('${lic.license_key}', this.checked)\">\n        </div>\n        \n        <!-- Col 1: åŸºæœ¬ä¿¡æ¯ -->\n        <div style=\"display:flex; align-items:center; gap:12px; min-width:0;\">\n          <div style=\"width:36px; height:36px; flex-shrink:0; background:#30363d; border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-weight:700; font-size:14px;\">\n            ${(lic.user_name || '?')[0].toUpperCase()}\n          </div>\n          <div style=\"min-width:0; overflow:hidden;\">\n            <div style=\"display:flex; align-items:center; gap:6px; margin-bottom:4px;\">\n              <span style=\"font-weight:600; font-size:13px; color:var(--text-bright); overflow:hidden; text-overflow:ellipsis; white-space:nowrap;\">${lic.user_name || '<span style=\"color:var(--text-main); font-style:italic\">æœªæŒ‡å®šç”¨æˆ·</span>'}</span>\n              <span style=\"cursor:pointer; opacity:0.6; font-size:11px;\" onclick=\"editUserName('${lic.license_key}','${lic.user_name || \"\"}')\" title=\"ä¿®æ”¹ç”¨æˆ·å¤‡æ³¨\">âœï¸</span>\n              <span class=\"badge ${isRevoked ? 'badge-danger' : 'badge-success'}\" style=\"transform: scale(0.85); transform-origin:left; margin-left:2px;\">${lic.status.toUpperCase()}</span>\n            </div>\n            <div style=\"display:flex; align-items:center; gap:6px;\">\n              <span style=\"font-family:monospace; font-size:12px; color:var(--accent);\">${lic.license_key}</span>\n              <span style=\"cursor:pointer; opacity:0.6; font-size:12px;\" onclick=\"copyText('${lic.license_key}')\" title=\"å¤åˆ¶å¡å¯†\">ğŸ“‹</span>\n            </div>\n          </div>\n        </div>\n        \n        <!-- Col 2: è®¢é˜…æ ‡ç­¾ -->\n        <div style=\"font-size:12px; display:flex; flex-wrap:wrap; gap:4px; align-items:center;\">\n          ${subHtml}\n          <span onclick=\"addSub('${lic.license_key}')\" style=\"color:var(--accent); cursor:pointer; font-weight:500; font-size:11px; margin-left:4px; padding:2px 6px; background:var(--accent-glow); border-radius:4px;\">+ ç»­è´¹ç®¡ç†</span>\n        </div>\n\n        <!-- Col 3: è®¾å¤‡å ç”¨ -->\n        <div style=\"font-size:12px; display:flex; flex-direction:column; justify-content:center;\">\n          <div style=\"color:var(--text-bright); margin-bottom:4px; font-weight:500; display:flex; align-items:center;\">\n            <div style=\"flex-shrink:0;\">${lic.current_devices} <span style=\"color:var(--text-main); font-weight:normal;\">/ ${lic.max_devices} å°</span></div>\n            <button class=\"secondary\" onclick=\"toggleDevicePanel('${lic.license_key}')\" style=\"margin-left:6px; padding:2px 6px; font-size:11px; height:auto; background:var(--panel-bg); border-color:#30363d; flex-shrink:0;\" title=\"å±•å¼€æŸ¥çœ‹å…·ä½“è®¾å¤‡\">ğŸ” è¯¦æƒ…</button>\n          </div>\n          <div style=\"height:4px; width:100%; max-width:80px; background:#30363d; border-radius:2px; overflow:hidden;\">\n            <div style=\"width:${devicePct}%; height:100%; background:var(--accent);\"></div>\n          </div>\n        </div>\n\n        <!-- Col 4: æ“ä½œ -->\n        <div style=\"display:flex; gap:8px; justify-content:flex-end;\">\n          <button class=\"secondary\" style=\"padding:4px 8px; font-size:12px;\" onclick=\"toggleStatus('${lic.license_key}', '${isRevoked ? 'active' : 'revoked'}')\">\n            ${isRevoked ? 'ğŸ”“ æ¢å¤' : 'ğŸ”’ åŠé”€'}\n          </button>\n          <button class=\"danger\" style=\"padding:4px 8px; font-size:12px;\" onclick=\"deleteLic('${lic.license_key}')\" title=\"å½»åº•åˆ é™¤\">ğŸ—‘ï¸</button>\n        </div>\n      </div>\n      <!-- åŠ¨æ€è®¾å¤‡é¢æ¿æ’æ§½ -->\n      <div id=\"devicePanel_${lic.license_key}\" style=\"display:none; grid-column:1/-1; background:#0d1117; border-top:1px dashed #30363d; padding:12px 16px;\"></div>\n    `;\n      });\n\n      html += '</div>';\n\n      html += '</div>';\n\n      // ==========================================\n      // æ›´æ–°é¡¶éƒ¨åŠåº•éƒ¨åˆ†é¡µå¯¼èˆª (æå–é€»è¾‘)\n      // ==========================================\n      const renderPagination = () => {\n        if (totalItems === 0) return '';\n        return `\n          <div style=\"display:flex; align-items:stretch; gap:8px;\">\n            <select style=\"padding:0 12px; font-size:14px; border-radius:6px; background:#21262d; color:var(--text-bright); border:1px solid var(--border-color); outline:none; cursor:pointer;\" onchange=\"changePageSize(this.value)\">\n              <option value=\"10\" ${PAGE_SIZE === 10 ? 'selected' : ''}>10æ¡/é¡µ</option>\n              <option value=\"20\" ${PAGE_SIZE === 20 ? 'selected' : ''}>20æ¡/é¡µ</option>\n              <option value=\"50\" ${PAGE_SIZE === 50 ? 'selected' : ''}>50æ¡/é¡µ</option>\n              <option value=\"100\" ${PAGE_SIZE === 100 ? 'selected' : ''}>100æ¡/é¡µ</option>\n            </select>\n            <button class=\"secondary\" style=\"white-space:nowrap; flex-shrink:0;\" onclick=\"goToPage(${currentPage - 1})\" ${currentPage === 1 ? 'disabled style=\"opacity:0.5;cursor:not-allowed\"' : ''}>â† ä¸Šä¸€é¡µ</button>\n            <div style=\"display:flex; align-items:center; padding:0 16px; font-size:14px; color:var(--text-main); background:var(--card-bg); border-radius:6px; border:1px solid var(--border-color); white-space:nowrap; flex-shrink:0;\">\n              ç¬¬ <span style=\"color:var(--text-bright); font-weight:bold; margin:0 4px;\">${currentPage}</span>/ ${totalPages} é¡µ\n            </div>\n            <button class=\"secondary\" style=\"white-space:nowrap; flex-shrink:0;\" onclick=\"goToPage(${currentPage + 1})\" ${currentPage === totalPages ? 'disabled style=\"opacity:0.5;cursor:not-allowed\"' : ''}>ä¸‹ä¸€é¡µ â†’</button>\n          </div>\n        `;\n      };\n\n      const topPag = document.getElementById('topPagination');\n      if (topPag) {\n        topPag.innerHTML = renderPagination();\n      }\n\n      container.innerHTML = html;\n    }\n\n    // åˆ‡æ¢åˆ†é¡µå¤§å°\n    function changePageSize(size) {\n      PAGE_SIZE = parseInt(size);\n      currentPage = 1;\n      const kw = document.getElementById('keywordSearch').value.toLowerCase();\n      if (kw) {\n        const filtered = ALL_LICENSES.filter((l) =>\n          l.license_key.toLowerCase().includes(kw) ||\n          (l.user_name && l.user_name.toLowerCase().includes(kw))\n        );\n        renderCards(filtered);\n      } else {\n        renderCards(ALL_LICENSES);\n      }\n    }\n\n    // åˆ†é¡µè·³è½¬å‡½æ•°\n    function goToPage(page) {\n      currentPage = page;\n      // è·å–å½“å‰çš„æœç´¢çŠ¶æ€ï¼Œåº”ç”¨è¿‡æ»¤å¹¶é‡æ–°æ¸²æŸ“å½“å‰é¡µ\n      const kw = document.getElementById('keywordSearch').value.toLowerCase();\n      if (kw) {\n        const filtered = ALL_LICENSES.filter((l) =>\n          l.license_key.toLowerCase().includes(kw) ||\n          (l.user_name && l.user_name.toLowerCase().includes(kw))\n        );\n        renderCards(filtered);\n      } else {\n        renderCards(ALL_LICENSES);\n      }\n      // æ»šåŠ¨å›åˆ—è¡¨é¡¶éƒ¨\n      window.scrollTo({ top: document.getElementById('licListContainer').offsetTop - 60, behavior: 'smooth' });\n    }\n\n    // æœç´¢è¿‡æ»¤\n    function filterLocalList() {\n      const kw = document.getElementById('keywordSearch').value.toLowerCase();\n      const filtered = ALL_LICENSES.filter((l) =>\n        l.license_key.toLowerCase().includes(kw) ||\n        (l.user_name && l.user_name.toLowerCase().includes(kw))\n      );\n      currentPage = 1; // æœç´¢æ¡ä»¶æ”¹å˜æ—¶ï¼Œé‡ç½®å›ç¬¬ä¸€é¡µ\n      renderCards(filtered);\n    }\n\n    // ç”Ÿå¡é€»è¾‘\n    async function doGenerate() {\n      const btn = document.getElementById('btnDoGen');\n      const pId = document.getElementById('genProductId').value;\n      const uName = document.getElementById('genUserName').value;\n      const cnt = parseInt(document.getElementById('genCount').value);\n      const mD = parseInt(document.getElementById('genMaxDevices').value);\n      const dur = document.getElementById('genDuration').value;\n\n      btn.disabled = true; btn.innerText = \"âš¡ æ­£åœ¨ç‚¼åˆ¶æ¿€æ´»ç ...\";\n\n      try {\n        const res = await fetch('/api/v1/auth/admin/generate', {\n          method: 'POST',\n          headers: { 'Authorization': 'Bearer ' + ADMIN_SECRET, 'Content-Type': 'application/json' },\n          body: JSON.stringify({ product_id: pId, user_name: uName, count: cnt, max_devices: mD, duration_days: dur ? parseInt(dur) : null })\n        });\n        const data = await res.json();\n        if (data.success) {\n          document.getElementById('genResult').style.display = 'block';\n          document.getElementById('genOutput').innerText = data.keys.join('\\n');\n          renderCards([]); // ç”Ÿå¡åæ¸…ç©ºåˆ—è¡¨æç¤ºåˆ·æ–°\n        } else { showModal({ title: 'é”™è¯¯', message: data.msg, type: 'alert' }); }\n      } catch (e) { showModal({ title: 'é€šè®¯å¤±è´¥', message: e.message, type: 'alert' }); }\n      finally { btn.disabled = false; btn.innerText = \"âœ¨ ç«‹å³åˆ¶å¡å¹¶æ¿€æ´»è®¢é˜…\"; }\n    }\n\n    // API äº¤äº’å‡½æ•°\n    async function toggleStatus(key, status) {\n      const isRestore = status === 'active';\n      const confirmed = await showModal({\n        title: isRestore ? 'ğŸ”“ æ¢å¤ä½¿ç”¨' : 'ğŸ”’ åŠé”€å¡å¯†',\n        message: 'ç¡®å®šè¦' + (isRestore ? 'æ¢å¤' : 'åŠé”€') + 'å¡å¯†[<span style=\"color:var(--accent)\">' + key + '</span>]å—ï¼Ÿ',\n        confirmText: 'ç¡®å®š',\n        danger: !isRestore\n      });\n      if (!confirmed) return;\n      const res = await fetch('/api/v1/auth/admin/licenses/status', {\n        method: 'POST',\n        headers: { 'Authorization': 'Bearer ' + ADMIN_SECRET, 'Content-Type': 'application/json' },\n        body: JSON.stringify({ license_key: key, status })\n      });\n      if ((await res.json()).success) loadLicenses();\n    }\n\n    async function deleteLic(key) {\n      const confirmed = await showModal({\n        title: 'ğŸ—‘ï¸ å½»åº•åœäº§',\n        message: 'âš ï¸ å±é™©: ç¡®å®šåˆ é™¤å¡å¯†[<span style=\"color:var(--danger)\">' + key + '</span>]å—ï¼Ÿæ­¤æ“ä½œä¸å¯é€†ï¼',\n        confirmText: 'ç¡®è®¤åˆ é™¤',\n        danger: true\n      });\n      if (!confirmed) return;\n      const res = await fetch('/api/v1/auth/admin/licenses', {\n        method: 'DELETE',\n        headers: { 'Authorization': 'Bearer ' + ADMIN_SECRET, 'Content-Type': 'application/json' },\n        body: JSON.stringify({ license_key: key })\n      });\n      if ((await res.json()).success) loadLicenses();\n    }\n\n    async function editUserName(key, cur) {\n      const res = await showModal({\n        title: 'âœï¸ ä¿®æ”¹ç”¨æˆ·å¤‡æ³¨',\n        inputs: [{ label: 'ç”¨æˆ·åæˆ–å†…éƒ¨å¤‡æ³¨', value: cur, placeholder: 'è¾“å…¥æ–°å¤‡æ³¨' }],\n        confirmText: 'ä¿å­˜ä¿®æ”¹'\n      });\n      if (!res) return;\n      const n = res[0];\n      await fetch('/api/v1/auth/admin/licenses/user', {\n        method: 'POST',\n        headers: { 'Authorization': 'Bearer ' + ADMIN_SECRET, 'Content-Type': 'application/json' },\n        body: JSON.stringify({ license_key: key, user_name: n })\n      });\n      loadLicenses();\n    }\n    // æ·»åŠ äº§å“ç»­è´¹ç®¡ç†\n    async function addSub(key) {\n      const res = await showModal({\n        title: 'â• æ·»åŠ è®¢é˜…æˆ–ç»­è´¹',\n        message: 'æ­£åœ¨ä¸º <b>' + key + '</b> é…ç½®æƒé™ã€‚<br/><span style=\"color:var(--warning); font-size:12px;\">æ³¨ï¼šå¦‚éœ€æ¸…é™¤è¯¯ç»‘äº§å“ï¼Œè¯·å¡«å…¥äº§å“ ID å¹¶å°†æ—¶é•¿è®¾ä¸º 0ã€‚</span>',\n        inputs: [\n          { label: 'äº§å“çº¿æ ‡è¯† (Product ID)', value: 'smartmp', placeholder: 'å¦‚ smartmp' },\n          { label: 'ç»­è´¹æ—¶é•¿ (å¤©æ•°)', value: '365', placeholder: 'å¡« 365 å³åŠ ä¸€å¹´ï¼Œå¡« 0 æ¸…é™¤ï¼Œç•™ç©ºæ°¸ä¹…' }\n        ],\n        confirmText: 'ç¡®è®¤åŠç†'\n      });\n\n      if (!res) return;\n      const pId = res[0] ? res[0].trim() : '';\n      const dVal = res[1] ? res[1].trim() : '';\n      if (!pId) return;\n\n      let days = null;\n      if (dVal !== '') {\n        days = parseInt(dVal);\n        if (isNaN(days)) return showModal({ title: 'é”™è¯¯', message: 'å¤©æ•°å¿…é¡»æ˜¯çº¯æ•°å­—', type: 'alert' });\n      }\n\n      try {\n        const fRes = await fetch('/api/v1/auth/admin/subscriptions', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + ADMIN_SECRET },\n          body: JSON.stringify({ license_key: key, product_id: pId, duration_days: days })\n        });\n        const data = await fRes.json();\n\n        if (data.success) {\n          showModal({\n            title: data.deleted ? 'âœ… æ¸…ç†æˆåŠŸ' : 'ğŸ‰ è®¢é˜…æˆåŠŸ',\n            message: data.deleted ? data.msg : 'åˆ°æœŸæ—¥: ' + (data.expires_at || 'æ°¸ä¹…æœ‰æ•ˆ'),\n            type: 'alert'\n          }).then(() => loadLicenses());\n        } else {\n          showModal({ title: 'æ“ä½œå¤±è´¥', message: data.msg, type: 'alert' });\n        }\n      } catch (e) {\n        showModal({ title: 'å‘ç”Ÿé”™è¯¯', message: e.message, type: 'alert' });\n      }\n    }\n\n    function copyText(t) {\n      navigator.clipboard.writeText(t);\n      const btn = window.event?.currentTarget;\n      if (btn) {\n        const old = btn.innerText;\n        btn.innerText = 'âœ…';\n        setTimeout(() => { btn.innerText = old; }, 1000);\n      }\n    }\n    async function copyGenResult() {\n      const txt = document.getElementById('genOutput').innerText;\n      await navigator.clipboard.writeText(txt);\n      showModal({ title: 'å¤åˆ¶æˆåŠŸ', message: 'å·²å°†æ‰€æœ‰æ¿€æ´»ç å­˜å…¥å‰ªè´´æ¿', type: 'alert' });\n    }\n\n    async function exportData() {\n      if (ALL_LICENSES.length === 0) return showModal({ title: 'æç¤º', message: 'å½“å‰æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®', type: 'alert' });\n      const dataStr = JSON.stringify(ALL_LICENSES, null, 2);\n      const blob = new Blob([dataStr], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = 'hw-licenses-backup-' + Date.now() + '.json';\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    }\n\n    // å¯¼å‡ºä¸ºé€‚åˆ Excel æ‰“å¼€çš„ CSV æ ¼å¼è¡¨æ ¼\n    async function exportExcel() {\n      if (ALL_LICENSES.length === 0) return showModal({ title: 'æç¤º', message: 'å½“å‰æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®', type: 'alert' });\n\n      // 1. æ„å»º CSV è¡¨å¤´\n      let csvContent = 'æ¿€æ´»ç æ ‡è¯†,ç»‘å®šç”¨æˆ·/å¤‡æ³¨,çŠ¶æ€,è®¾å¤‡é…é¢,å·²åˆ†é…è®¾å¤‡,åŒ…å«äº§å“æ•°,è®¢é˜…è¯¦æƒ…æ‘˜è¦,åˆ›å»ºæ—¶é—´\\n';\n\n      // 2. éå†æ•°æ®å¹³é“ºé™ç»´\n      ALL_LICENSES.forEach(lic => {\n        // å¤„ç†å¯èƒ½åŒ…å«é€—å·çš„å­—æ®µï¼Œç”¨å¼•å·åŒ…è£¹\n        const safeStr = (str) => '\"' + (str ? String(str).replace(/\"/g, '\"\"') : '') + '\"';\n\n        // åˆå¹¶è®¢é˜…è¯¦æƒ…ä¸ºä¸€ä¸ªæ˜“è¯»çš„å­—ç¬¦ä¸²\n        const subDigest = (lic.subscriptions || []).map(s => {\n          const expStr = s.expires_at ? new Date(s.expires_at).toLocaleDateString() : 'æ°¸ä¹…';\n          return '[' + s.product_id + ': ' + expStr + ']';\n        }).join(' | ');\n\n        const row = [\n          safeStr(lic.license_key),\n          safeStr(lic.user_name || 'æœªé…ç½®'),\n          lic.status === 'revoked' ? 'å·²åŠé”€' : 'æ´»è·ƒ',\n          lic.max_devices,\n          lic.current_devices,\n          (lic.subscriptions || []).length,\n          safeStr(subDigest),\n          safeStr(new Date(lic.created_at).toLocaleString())\n        ];\n        csvContent += row.join(',') + '\\n';\n      });\n\n      // 3. åŠ ä¸Š UTF-8 BOMï¼Œé˜²æ­¢ Windows ä¸‹ Excel æ‰“å¼€ç›´æ¥ä¹±ç \n      const blob = new Blob(['\\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = 'hw-licenses-report-' + Date.now() + '.csv';\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    }\n\n    async function importData(event) {\n      const file = event.target.files[0];\n      if (!file) return;\n      event.target.value = ''; // Reset input status\n\n      const reader = new FileReader();\n      reader.onload = async (e) => {\n        try {\n          const jsonStr = e.target?.result;\n          const licenses = JSON.parse(jsonStr);\n          if (!Array.isArray(licenses)) throw new Error(\"æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼šæœŸæœ› JSON æ•°ç»„\");\n\n          const confirmMsg = \"å³å°†å¯¼å…¥ \" + licenses.length + \" æ¡æ•°æ®ï¼Œå·²å­˜åœ¨çš„æ•°æ®å°†ä¼šè¢«èåˆè¦†ç›–ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ\";\n          const res = await showModal({ title: 'æ‰¹é‡å¯¼å…¥ç¡®è®¤', message: confirmMsg, type: 'confirm' });\n          if (!res) return;\n\n          const fRes = await fetch('/api/v1/auth/admin/licenses/import', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + ADMIN_SECRET },\n            body: JSON.stringify({ licenses })\n          });\n          const data = await fRes.json();\n\n          if (data.success) {\n            showModal({ title: 'âœ… å¯¼å…¥æˆåŠŸ', message: data.msg, type: 'alert' }).then(() => loadLicenses());\n          } else {\n            showModal({ title: 'âŒ å¯¼å…¥å¤±è´¥', message: data.msg, type: 'alert' });\n          }\n        } catch (err) {\n          showModal({ title: 'è§£æé”™è¯¯', message: err.message || err, type: 'alert' });\n        }\n      };\n      reader.readAsText(file);\n    }\n\n    // ==========================================\n    // æ‰¹é‡æ“ä½œé€»è¾‘\n    // ==========================================\n    function updateBatchBar() {\n      const bar = document.getElementById('batchBar');\n      const countDisplay = document.getElementById('batchCountDisplay');\n      if (!bar || !countDisplay) return;\n      const count = SET_SELECTED_KEYS.size;\n      countDisplay.innerText = count + ' é¡¹é€‰ä¸­';\n      if (count > 0) {\n        bar.classList.add('active');\n      } else {\n        bar.classList.remove('active');\n      }\n    }\n\n    function toggleBatchItem(key, isChecked) {\n      if (isChecked) {\n        SET_SELECTED_KEYS.add(key);\n      } else {\n        SET_SELECTED_KEYS.delete(key);\n      }\n      updateBatchBar();\n    }\n\n    function toggleAllCheckboxes(checkboxElem) {\n      const isChecked = checkboxElem.checked;\n      document.querySelectorAll('.row-checkbox').forEach(cb => {\n        cb.checked = isChecked;\n        if (isChecked) {\n          SET_SELECTED_KEYS.add(cb.value);\n        } else {\n          SET_SELECTED_KEYS.delete(cb.value);\n        }\n      });\n      updateBatchBar();\n    }\n\n    function clearBatchSelection() {\n      SET_SELECTED_KEYS.clear();\n      document.querySelectorAll('.row-checkbox').forEach(cb => cb.checked = false);\n      const headerCb = document.querySelector('.lic-header .custom-checkbox');\n      if (headerCb) headerCb.checked = false;\n      updateBatchBar();\n    }\n\n    async function executeBatch() {\n      const actionSelect = document.getElementById('batchActionSelect');\n      const action = actionSelect ? actionSelect.value : '';\n      if (!action) {\n        return showModal({ title: 'æç¤º', message: 'è¯·å…ˆé€‰æ‹©éœ€è¦æ‰§è¡Œçš„æ“ä½œç±»å‹', type: 'alert' });\n      }\n\n      const keys = Array.from(SET_SELECTED_KEYS);\n      if (keys.length === 0) {\n        return showModal({ title: 'æç¤º', message: 'è¯·å…ˆå‹¾é€‰è‡³å°‘ä¸€å¼ å¡å¯†', type: 'alert' });\n      }\n\n      // çº¯å‰ç«¯æ“ä½œï¼šæ‰¹é‡å¤åˆ¶å¡å¯†\n      if (action === 'copy_keys') {\n        try {\n          await navigator.clipboard.writeText(keys.join('\\n'));\n          showModal({ title: 'âœ… å¤åˆ¶æˆåŠŸ', message: 'å·²å°† ' + keys.length + ' ä¸ªæ¿€æ´»ç å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼' });\n          clearBatchSelection();\n        } catch (e) {\n          showModal({ title: 'å¤åˆ¶å¤±è´¥', message: 'æµè§ˆå™¨æ‹’ç»è®¿é—®å‰ªè´´æ¿ï¼Œè¯·æ‰‹åŠ¨å¤„ç†', type: 'alert' });\n        }\n        return;\n      }\n\n      let params = {};\n      const optionText = actionSelect.options[actionSelect.selectedIndex].text.replace(/^[\\u0000-\\uFFFF]{1,3}\\s/, '');\n\n      // éœ€è¦é¢å¤–å‚æ•°çš„æ“ä½œï¼šå¼¹çª—æ”¶é›†\n      if (action === 'set_user_name') {\n        const u = await showModal({\n          title: 'âœï¸ æ‰¹é‡è®¾ç½®å¤‡æ³¨',\n          message: 'å°† ' + keys.length + ' ä¸ªå¡å¯†çš„å¤‡æ³¨ç»Ÿä¸€ä¿®æ”¹ä¸ºï¼š',\n          inputs: [{ label: 'å¤‡æ³¨å†…å®¹', placeholder: 'å¦‚: 2026æ˜¥å­£æ´»åŠ¨æ‰¹æ¬¡' }]\n        });\n        if (u === false) return;\n        params.user_name = u[0] || '';\n      } else if (action === 'set_max_devices') {\n        const d = await showModal({\n          title: 'ğŸ”¢ æ‰¹é‡è°ƒæ•´è®¾å¤‡ä¸Šé™',\n          message: 'ä¸ºé€‰ä¸­çš„ ' + keys.length + ' ä¸ªå¡å¯†è®¾ç½®æ–°çš„æœ€å¤§è®¾å¤‡æ•°ï¼š',\n          inputs: [{ label: 'è®¾å¤‡æ•°é‡', type: 'number', placeholder: '1-100', value: '2' }]\n        });\n        if (d === false) return;\n        params.max_devices = parseInt(d[0]);\n      } else if (action === 'add_subscription') {\n        const u = await showModal({\n          title: 'ğŸš€ æ‰¹é‡ç»­è´¹ / æ·»åŠ äº§å“',\n          message: 'ä¸ºé€‰ä¸­çš„ ' + keys.length + ' ä¸ªå¡å¯†ç»Ÿä¸€æ·»åŠ æŒ‡å®šäº§å“æƒé™ï¼š',\n          inputs: [\n            { label: 'ç›®æ ‡äº§å“ ID', placeholder: 'å¦‚: smartmp' },\n            { label: 'æœ‰æ•ˆå¤©æ•°', type: 'number', placeholder: 'ç•™ç©ºè¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆ' }\n          ]\n        });\n        if (u === false) return;\n        params.product_id = u[0];\n        params.duration_days = u[1] ? parseInt(u[1]) : null;\n      } else if (action === 'remove_subscription') {\n        const u = await showModal({\n          title: 'âŒ æ‰¹é‡ç§»é™¤äº§å“æƒé™',\n          message: 'ä»é€‰ä¸­çš„å¡å¯†ä¸­å‰¥å¤ºæŒ‡å®šäº§å“çš„æˆæƒï¼š',\n          danger: true,\n          inputs: [{ label: 'è¦ç§»é™¤çš„äº§å“ ID', placeholder: 'å¦‚: smartmp' }]\n        });\n        if (u === false) return;\n        params.product_id = u[0];\n      } else {\n        // æ— é¢å¤–å‚æ•°çš„æ“ä½œï¼ˆåŠé”€/æ¢å¤/åˆ é™¤/è§£ç»‘ï¼‰\n        const isDanger = ['delete', 'revoke', 'unbind'].includes(action);\n        const confirmed = await showModal({\n          title: 'âš ï¸ æ‰¹é‡æ“ä½œç¡®è®¤',\n          message: 'å³å°†å¯¹ <strong style=\"color:var(--accent)\">' + keys.length + '</strong> ä¸ªå¡å¯†æ‰§è¡Œ <b>' + optionText + '</b> æ“ä½œã€‚ç¡®å®šç»§ç»­ï¼Ÿ',\n          danger: isDanger,\n          confirmText: isDanger ? 'ç¡®è®¤æ‰§è¡Œ' : 'ç¡®å®š'\n        });\n        if (!confirmed) return;\n      }\n\n      // è°ƒç”¨åç«¯ /batch æ¥å£\n      try {\n        const res = await fetch('/api/v1/auth/admin/licenses/batch', {\n          method: 'POST',\n          headers: {\n            'Authorization': 'Bearer ' + ADMIN_SECRET,\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({ keys, action, params })\n        });\n        const data = await res.json();\n        if (data.success) {\n          clearBatchSelection();\n          showModal({ title: 'âœ… æ‰§è¡ŒæˆåŠŸ', message: data.msg }).then ?\n            showModal({ title: 'âœ… æ‰§è¡ŒæˆåŠŸ', message: data.msg }).then(() => loadLicenses()) :\n            (showModal({ title: 'âœ… æ‰§è¡ŒæˆåŠŸ', message: data.msg }), loadLicenses());\n        } else {\n          showModal({ title: 'âŒ æ‰¹é‡æ“ä½œå¤±è´¥', message: data.msg, type: 'alert' });\n        }\n      } catch (err) {\n        showModal({ title: 'ç½‘ç»œé”™è¯¯', message: err.message || err, type: 'alert' });\n      }\n    }\n\n    // ==========================================\n    // è®¾å¤‡æ˜ç»†é¢æ¿æ§åˆ¶\n    // ==========================================\n    async function toggleDevicePanel(key) {\n      const panel = document.getElementById('devicePanel_' + key);\n      if (!panel) return;\n\n      // å¦‚æœå½“å‰æ˜¯å±•å¼€çŠ¶æ€ï¼Œåˆ™æ”¶èµ·\n      if (panel.style.display === 'block') {\n        panel.style.display = 'none';\n        panel.innerHTML = '';\n        return;\n      }\n\n      panel.style.display = 'block';\n      panel.innerHTML = '<div style=\"color:var(--text-main); font-size:12px; text-align:center; padding:10px;\">â³ æ­£åœ¨åŠ è½½è®¾å¤‡è®°å½•...</div>';\n\n      try {\n        const res = await fetch('/api/v1/auth/admin/licenses/' + key + '/devices', {\n          headers: { 'Authorization': 'Bearer ' + ADMIN_SECRET }\n        });\n        const data = await res.json();\n\n        if (!data.success) {\n          panel.innerHTML = '<div style=\"color:var(--danger); font-size:12px;\">âŒ ' + data.msg + '</div>';\n          return;\n        }\n\n        const devices = data.data;\n        if (devices.length === 0) {\n          panel.innerHTML = '<div style=\"color:var(--text-main); font-size:12px; font-style:italic;\">æš‚æ— ç»‘å®šè®¾å¤‡ã€‚</div>';\n          return;\n        }\n\n        let tableHtml = `\n          <table style=\"width:100%; background:#161b22; border-radius:6px; overflow:hidden; font-size:12px; margin:0; border:1px solid #30363d;\">\n            <thead>\n              <tr style=\"background:#21262d; text-align:left;\">\n                <th style=\"padding:6px 12px; font-weight:600;\">è®¾å¤‡åç§°</th>\n                <th style=\"padding:6px 12px; font-weight:600;\">è®¾å¤‡ç‰¹å¾ç  (Device ID)</th>\n                <th style=\"padding:6px 12px; font-weight:600;\">æœ€è¿‘åœ¨çº¿æ—¶é—´</th>\n                <th style=\"padding:6px 12px; text-align:right; font-weight:600;\">ç®¡ç†</th>\n              </tr>\n            </thead>\n            <tbody>\n        `;\n\n        devices.forEach(d => {\n          const lActive = d.last_active ? new Date(d.last_active + 'Z').toLocaleString() : 'æœªçŸ¥';\n          tableHtml += `\n            <tr style=\"border-top:1px solid #30363d;\">\n              <td style=\"padding:6px 12px; color:var(--text-bright);\">${d.device_name || 'æœªå‘½åè®¾å¤‡'}</td>\n              <td style=\"padding:6px 12px; font-family:monospace; color:#8b949e;\">${d.device_id}</td>\n              <td style=\"padding:6px 12px; color:#8b949e;\">${lActive}</td>\n              <td style=\"padding:6px 12px; text-align:right;\">\n                <button class=\"danger\" style=\"padding:2px 8px; font-size:11px;\" onclick=\"removeSingleDevice('${key}', '${d.device_id}')\">å¼ºè§£</button>\n              </td>\n            </tr>\n          `;\n        });\n\n        tableHtml += '</tbody></table>';\n        panel.innerHTML = tableHtml;\n\n      } catch (err) {\n        panel.innerHTML = '<div style=\"color:var(--danger); font-size:12px;\">âŒ æ— æ³•å­˜å–è®¾å¤‡æ•°æ®</div>';\n      }\n    }\n\n    async function removeSingleDevice(key, deviceId) {\n      const confirmMsg = \"ç¡®å®šè¦å¼ºåˆ¶æ³¨é”€è¯¥è®¾å¤‡å—ï¼Ÿè¸¢å‡ºåï¼Œè¯¥è®¾å¤‡çš„å®¢æˆ·ç«¯å°†å¤±å»æˆæƒç½‘ç»œã€‚\";\n      const confirmed = await showModal({ title: 'âš ï¸ å¼ºè§£ç¡®è®¤', message: confirmMsg, danger: true });\n      if (!confirmed) return;\n\n      try {\n        const res = await fetch('/api/v1/auth/admin/licenses/' + key + '/devices/' + encodeURIComponent(deviceId), {\n          method: 'DELETE',\n          headers: { 'Authorization': 'Bearer ' + ADMIN_SECRET }\n        });\n        const data = await res.json();\n        if (data.success) {\n          // ä¸åˆ·æ–°å…¨å±€ï¼Œåªé‡åˆ·å½“å‰é¢æ¿å’Œå±€éƒ¨é¢åº¦ï¼Œæå‡ä½“éªŒ\n          toggleDevicePanel(key); // æ”¶èµ·\n          setTimeout(() => toggleDevicePanel(key), 300); // é‡æ–°æ‰“å¼€\n          loadLicenses(); // ç¨å¾®é™é»˜é‡åˆ·ä¸€æ¬¡å¤§åˆ—è¡¨æ›´æ–°é¢åº¦æ•°å­—\n        } else {\n          showModal({ title: 'æ“ä½œå¤±è´¥', message: data.msg, type: 'alert' });\n        }\n      } catch (err) {\n        showModal({ title: 'ç½‘ç»œé”™è¯¯', message: err.message, type: 'alert' });\n      }\n    }\n  </script>\n</body>\n\n</html>";