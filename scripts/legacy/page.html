
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äº’ä¸ºå¡å¯†ä¸­å¿ƒ - å¼€å‘è€…æ§åˆ¶å°</title>
  <style>
    :root {
      --bg-color: #0d1117;
      --panel-bg: #161b22;
      --card-bg: #21262d;
      --border-color: #30363d;
      --text-main: #8b949e;
      --text-bright: #c9d1d9;
      --accent: #58a6ff;
      --accent-glow: rgba(88, 166, 255, 0.15);
      --success: #3fb950;
      --warning: #d29922;
      --danger: #f85149;
      --indigo: #5385ff;
    }
    body {
      margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
      background: var(--bg-color); color: var(--text-bright); line-height: 1.6;
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 40px 20px; }
    
    /* Header & Stats */
    .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px; }
    .header-title { display: flex; align-items: center; gap: 12px; }
    .header-title h1 { font-size: 20px; font-weight: 600; margin: 0; }
    
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .stat-card { background: var(--panel-bg); border: 1px solid var(--border-color); padding: 20px; border-radius: 12px; }
    .stat-label { font-size: 13px; color: var(--text-main); margin-bottom: 8px; }
    .stat-value { font-size: 24px; font-weight: 700; display: flex; align-items: center; gap: 8px; }

    /* Tabs */
    .tabs { display: flex; gap: 8px; margin-bottom: 24px; border-bottom: 1px solid var(--border-color); }
    .tab {
      padding: 12px 20px; cursor: pointer; color: var(--text-main); font-weight: 500;
      border-bottom: 2px solid transparent; transition: 0.2s; position: relative;
    }
    .tab:hover { color: var(--text-bright); }
    .tab.active { color: var(--accent); border-bottom-color: var(--accent); }

    .section { display: none; }
    .section.active { display: block; }
    
    /* Forms & Inputs */
    .card { background: var(--panel-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; margin-bottom: 24px; }
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 20px; }
    .form-group label { display: block; font-size: 13px; font-weight: 500; margin-bottom: 8px; color: var(--text-main); }
    input, select {
      width: 100%; padding: 10px 12px; background: #0d1117; border: 1px solid var(--border-color);
      border-radius: 6px; color: var(--text-bright); outline: none; transition: 0.2s; box-sizing: border-box;
    }
    input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); }
    
    button {
      padding: 10px 20px; border-radius: 6px; font-weight: 600; cursor: pointer; transition: 0.2s;
      border: 1px solid transparent; font-size: 14px; display: inline-flex; align-items: center; justify-content: center; gap: 6px;
    }
    button.primary { background: var(--indigo); color: white; }
    button.primary:hover { opacity: 0.9; }
    button.secondary { background: #21262d; border-color: var(--border-color); color: var(--text-bright); }
    button.secondary:hover { background: #30363d; }
    button.danger { background: transparent; color: var(--danger); border-color: var(--danger); }
    button.danger:hover { background: var(--danger); color: white; }

    /* Grid Layout for Licenses */
    .lic-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 16px; margin-top: 20px; }
    .lic-card { background: var(--panel-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; transition: 0.2s; position: relative; }
    .lic-card:hover { border-color: var(--accent); background: #1c2128; transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }

    .badge { padding: 2px 8px; border-radius: 2em; font-size: 12px; font-weight: 600; }
    .badge-success { background: rgba(63, 185, 80, 0.1); color: var(--success); border: 1px solid rgba(63, 185, 80, 0.2); }
    .badge-warning { background: rgba(210, 153, 34, 0.1); color: var(--warning); border: 1px solid rgba(210, 153, 34, 0.2); }
    .badge-danger { background: rgba(248, 81, 73, 0.1); color: var(--danger); border: 1px solid rgba(248, 81, 73, 0.2); }

    /* Auth Overlay */
    #adminAuth { position: fixed; inset: 0; background: var(--bg-color); display: flex; items-center: center; justify-content: center; align-items: center; z-index: 1000; }
    .login-card { width: 340px; padding: 32px; background: var(--panel-bg); border: 1px solid var(--border-color); border-radius: 12px; text-align: center; }
  </style>
<body>

<div id="adminAuth">
  <div class="login-card">
    <h2 style="margin-top:0; color:var(--text-bright)">ğŸ”‘ èº«ä»½éªŒè¯</h2>
    <p style="color:var(--text-main); font-size:14px; margin-bottom:24px;">è¾“å…¥ç®¡ç†å‘˜å¯†é’¥ä»¥è¿›å…¥æ§åˆ¶å°</p>
    <div class="form-group" style="text-align:left; position:relative;">
      <input type="password" id="globalSecret" placeholder="è¾“å…¥ Admin Secret..." value="" style="padding-right: 40px;">
      <span onclick="const i=document.getElementById('globalSecret');if(i.type==='password'){i.type='text';this.innerText='ğŸ™ˆ'}else{i.type='password';this.innerText='ğŸ‘ï¸'}" style="position:absolute; right:12px; top:50%; transform:translateY(-50%); cursor:pointer; opacity:0.6; user-select:none;">ğŸ‘ï¸</span>
    </div>
    <button class="primary" style="width:100%; margin-top:16px;" onclick="login()">è¿›å…¥æ§åˆ¶å°</button>
  </div>
</div>

<div class="container">
  <div class="header">
    <div class="header-title">
      <div style="background:var(--indigo); padding:8px; border-radius:8px; display:flex;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
      </div>
      <h1>äº’ä¸ºå¡å¯†ä¸­å¿ƒ</h1>
    </div>
    <button class="secondary" onclick="loadLicenses()">ğŸ”„ åˆ·æ–°åˆ—è¡¨</button>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-label">æ€»å¡å¯†æ•° (Keys)</div>
      <div class="stat-value" id="stat-total">-</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">æ´»è·ƒä¸­ (Active)</div>
      <div class="stat-value" id="stat-active" style="color:var(--success)">-</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">å·²åŠé”€ (Revoked)</div>
      <div class="stat-value" id="stat-revoked" style="color:var(--danger)">-</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">ä¸´æœŸ/å·²è¿‡æœŸ (Sub)</div>
      <div class="stat-value" id="stat-expiring" style="color:var(--warning)">-</div>
    </div>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="switchTab('generate')">âš¡ æé€Ÿç”Ÿå¡</div>
    <div class="tab" onclick="switchTab('manage')">ğŸ› ï¸ èµ„äº§ç®¡ç†</div>
  </div>

  <!-- Tab: Generate -->
  <div id="sec-generate" class="section active">
    <div class="card">
      <div class="form-grid">
        <div class="form-group">
          <label>äº§å“çº¿æ ‡è¯† (Product ID)</label>
          <input type="text" id="genProductId" value="smartmp" list="productHistory" placeholder="è¾“å…¥ ID æˆ–é€‰æ‹©å†å²è®°å½•">
          <datalist id="productHistory"></datalist>
        </div>
        <div class="form-group">
          <label>ç»‘å®šç”¨æˆ·å / å¤‡æ³¨ (å¯é€‰)</label>
          <input type="text" id="genUserName" placeholder="ä¾‹å¦‚: å®¢æˆ·åã€å†…éƒ¨è®¢å•å·...">
        </div>
      </div>
      <div class="form-grid">
        <div class="form-group">
          <label>æ¿€æ´»ç è®¾å¤‡é…é¢ (Max Devices)</label>
          <input type="number" id="genMaxDevices" value="2" min="1">
        </div>
        <div class="form-group">
          <label>åˆå§‹è®¢é˜…æœ‰æ•ˆæœŸ (å¤©æ•°, ç•™ç©ºä¸ºæ°¸ä¹…)</label>
          <input type="number" id="genDuration" placeholder="ä¾‹å¦‚: 365, 30...">
        </div>
        <div class="form-group">
          <label>æ‰¹é‡ç”Ÿæˆæ•°é‡</label>
          <input type="number" id="genCount" value="1" min="1" max="100">
        </div>
      </div>
      <button class="primary" id="btnDoGen" onclick="doGenerate()" style="width:100%; margin-top:10px;">âœ¨ ç«‹å³åˆ¶å¡å¹¶æ¿€æ´»è®¢é˜…</button>
      
      <div id="genResult" style="display:none; margin-top:24px; padding-top:24px; border-top:1px dashed var(--border-color);">
        <label style="color:var(--success); font-weight:600; margin-bottom:12px; display:block;">âœ… ç”ŸæˆæˆåŠŸï¼Œè¯·å¤åˆ¶ä¿å­˜ï¼š</label>
        <div id="genOutput" style="background:#0d1117; padding:16px; border-radius:8px; font-family:monospace; font-size:13px; margin-bottom:16px; white-space:pre-wrap; border:1px solid var(--border-color); color:var(--success);"></div>
        <button class="secondary" style="width:100%" onclick="copyGenResult()">ğŸ“‹ å¤åˆ¶å…¨éƒ¨å¡å¯†æ–‡æœ¬</button>
      </div>
    </div>
  </div>

  <!-- Tab: Manage -->
  <div id="sec-manage" class="section">
    <div class="search-bar">
      <div class="search-input-wrap">
        <input type="text" id="keywordSearch" placeholder="å¿«é€Ÿæœç´¢æ¿€æ´»ç ã€ç”¨æˆ·å..." oninput="filterLocalList()">
      </div>
      <div style="width:200px">
        <select id="filterProductId" onchange="loadLicenses()">
          <option value="">æ‰€æœ‰äº§å“çº¿ (Show All)</option>
        </select>
      </div>
    </div>

    <!-- é˜¶æ®µä¸€äºŒè¿‡æ¸¡ï¼šæš‚æ—¶ä¿ç•™ table å®¹å™¨åï¼Œä»¥ä¾¿ JS è¿˜èƒ½å¡«å……æ•°æ®ï¼Œä¸‹ä¸€é˜¶æ®µå°†å½»åº•æ”¹ä¸ºç½‘æ ¼å¡ç‰‡ -->
    <div id="licListContainer">
      <div class="table-container">
        <table id="licTable">
          <thead>
            <tr>
              <th>æ¿€æ´»ç (Key)</th>
              <th>åŸºæœ¬ä¿¡æ¯</th>
              <th>å½“å‰è®¢é˜…</th>
              <th>è®¾å¤‡ä½¿ç”¨</th>
              <th>å¿«æ·æ“ä½œ</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
  let ADMIN_SECRET = "";
  let ALL_LICENSES = []; // æœ¬åœ°æ•°æ®ç¼“å­˜
  let PRODUCT_HISTORY = new Set(['smartmp']);

  function login() {
    const s = document.getElementById('globalSecret').value;
    if (!s) return;
    ADMIN_SECRET = s;
    document.getElementById('adminAuth').style.display = 'none';
    loadLicenses();
  }

  function switchTab(tab) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    const target = (event && event.target) ? event.target : document.querySelector('.tab[onclick*="' + tab + '"]');
    if(target) target.classList.add('active');
    document.getElementById('sec-' + tab).classList.add('active');
    if (tab === 'manage') loadLicenses();
  }

  // è®¡ç®—å¹¶æ›´æ–°é¡¶éƒ¨ç»Ÿè®¡æŒ‡æ ‡
  function updateStats() {
    const total = ALL_LICENSES.length;
    const active = ALL_LICENSES.filter(l => l.status === 'active').length;
    const revoked = ALL_LICENSES.filter(l => l.status === 'revoked').length;
    
    // ä¸´æœŸè®¢é˜… (7å¤©å†…è¿‡æœŸ)
    const now = new Date();
    const SEVEN_DAYS = 7 * 24 * 60 * 60 * 1000;
    const expiring = ALL_LICENSES.filter(l => {
      if (!l.subscriptions) return false;
      return l.subscriptions.some(s => {
        if (!s.expires_at) return false;
        const diff = new Date(s.expires_at) - now;
        return diff > 0 && diff <= SEVEN_DAYS;
      });
    }).length;

    document.getElementById('stat-total').innerText = total;
    document.getElementById('stat-active').innerText = active;
    document.getElementById('stat-revoked').innerText = revoked;
    document.getElementById('stat-expiring').innerText = expiring;
  }

  // æ›´æ–°äº§å“ç­›é€‰ä¸‹æ‹‰æ¡†å’Œå†å²è¾“å…¥æç¤º
  function updateProductHelpers() {
    const select = document.getElementById('filterProductId');
    const datalist = document.getElementById('productHistory');
    
    // æ”¶é›†å½“å‰æ‰€æœ‰äº§å“ ID
    ALL_LICENSES.forEach(l => PRODUCT_HISTORY.add(l.product_id));
    
    // æ›´æ–°ç­›é€‰ä¸‹æ‹‰
    const currentFilter = select.value;
    select.innerHTML = '<option value="">æ‰€æœ‰äº§å“çº¿ (Show All)</option>';
    [...PRODUCT_HISTORY].sort().forEach(p => {
      const opt = document.createElement('option');
      opt.value = p; opt.innerText = p;
      select.appendChild(opt);
    });
    select.value = currentFilter;

    // æ›´æ–°ç”Ÿå¡ datalist
    datalist.innerHTML = '';
    [...PRODUCT_HISTORY].sort().forEach(p => {
      const opt = document.createElement('option');
      opt.value = p;
      datalist.appendChild(opt);
    });
  }

  // æ¥å£åŠ è½½æ•°æ®
  async function loadLicenses() {
    const pId = document.getElementById('filterProductId').value;
    const container = document.getElementById('licListContainer');
    container.innerHTML = '<div style="text-align:center; padding:50px; color:var(--text-main)">ğŸš€ æ­£åœ¨åŒæ­¥è¾¹ç¼˜æ•°æ®...</div>';

    try {
      const res = await fetch('/api/v1/auth/admin/licenses?product_id=' + pId, {
        headers: { 'Authorization': 'Bearer ' + ADMIN_SECRET }
      });
      const data = await res.json();
      if (!data.success) { 
        container.innerHTML = '<div style="padding:20px; color:var(--danger)">âŒ æƒé™éªŒè¯å¤±è´¥: ' + data.msg + '</div>';
        return;
      }
      
      ALL_LICENSES = data.data;
updateStats();
updateProductHelpers();
renderCards(ALL_LICENSES);
    } catch (e) {
  container.innerHTML = '<div style="padding:20px; color:var(--danger)">âš ï¸ æ— æ³•è¿æ¥æœåŠ¡å™¨</div>';
}
  }

// æ¸²æŸ“å¡ç‰‡ç½‘æ ¼å¸ƒå±€
function renderCards(list) {
  const container = document.getElementById('licListContainer');
  if (list.length === 0) {
    container.innerHTML = '<div style="text-align:center; padding:50px; color:var(--text-main)">ğŸ“­ æš‚æ— ç›¸å…³å¡å¯†æ•°æ®</div>';
    return;
  }

  container.innerHTML = '<div class="lic-grid" id="cardGrid"></div>';
  const grid = document.getElementById('cardGrid');
  const now = new Date();

  list.forEach((lic) => {
    const card = document.createElement('div');
    card.className = 'lic-card';

    // å‡†å¤‡è®¢é˜…çŠ¶æ€ HTML
    let subHtml = '';
    if (lic.subscriptions && lic.subscriptions.length > 0) {
      subHtml = lic.subscriptions.map((s) => {
        let text = 'æ°¸ ä¹…';
        let cls = 'badge-success';
        if (s.expires_at) {
          const days = Math.ceil((new Date(s.expires_at) - now) / (86400000));
          text = days > 0 ? 'å‰© ' + days + ' å¤©' : 'å·²è¿‡æœŸ';
          cls = days > 7 ? 'badge-success' : (days > 0 ? 'badge-warning' : 'badge-danger');
        }
        return '<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:4px; font-size:12px;">' +
          '<span style="color:var(--text-main)">' + s.product_id + '</span>' +
          '<span class="badge ' + cls + '">' + text + '</span>' +
          '</div>';
      }).join('');
    } else {
      subHtml = '<div style="color:var(--text-main); font-size:12px; font-style:italic">æš‚æ— è®¢é˜…äº§å“</div>';
    }

    const isRevoked = lic.status === 'revoked';
    const devicePct = Math.min(100, (lic.current_devices / lic.max_devices) * 100);

    card.innerHTML = `
        <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:12px;">
          <div style="font-family:monospace; font-weight:700; color:var(--accent); font-size:15px; letter-spacing:0.5px;">${lic.license_key}</div>
          <button class="secondary" style="padding:4px; border-radius:4px;" onclick="copyText('${lic.license_key}')" title="å¤åˆ¶å¡å¯†">ğŸ“‹</button>
        </div>
        
        <div style="display:flex; align-items:center; gap:10px; margin-bottom:16px;">
          <div style="width:36px; height:36px; background:#30363d; border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--text-bright); font-weight:700; font-size:14px;">
            ${(lic.user_name || '?')[0].toUpperCase()}
          </div>
          <div style="flex:1">
            <div style="font-weight:600; font-size:14px; display:flex; align-items:center; gap:4px;">
                ${lic.user_name || '<span style="color:var(--text-main)">æœªæŒ‡å®šç”¨æˆ·</span>'}
                <span style="cursor:pointer; opacity:0.5" onclick="editUserName('${lic.license_key}','${lic.user_name||""}')">âœï¸</span>
            </div>
            <div style="font-size:11px; color:var(--text-main)">ä¸»çº¿: ${lic.product_id}</div>
          </div>
          <span class="badge ${isRevoked ? 'badge-danger' : 'badge-success'}" style="height:fit-content">${lic.status.toUpperCase()}</span>
        </div>

        <div style="background:rgba(0,0,0,0.2); padding:12px; border-radius:8px; margin-bottom:16px;">
          <div style="font-size:11px; color:var(--text-main); margin-bottom:8px; display:flex; justify-content:space-between;">
            <span>è®¢é˜…æƒé™åº“</span>
            <span onclick="addSub('${lic.license_key}')" style="color:var(--accent); cursor:pointer;">+ ç»­è´¹ç®¡ç†</span>
          </div>
          ${subHtml}
        </div>

        <div style="margin-bottom:16px;">
          <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:6px;">
            <span style="color:var(--text-main)">è®¾å¤‡å ç”¨æƒ…å†µ</span>
            <span>${lic.current_devices} / ${lic.max_devices}</span>
          </div>
          <div style="height:4px; background:#30363d; border-radius:2px; overflow:hidden;">
            <div style="width:${devicePct}%; height:100%; background:var(--accent); transition:0.3s;"></div>
          </div>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
          <button class="secondary" style="font-size:12px; padding:6px" onclick="toggleStatus('${lic.license_key}', '${isRevoked ? 'active' : 'revoked'}')">
            ${isRevoked ? 'ğŸ”“ æ¢å¤ä½¿ç”¨' : 'ğŸ”’ åŠé”€å¡å¯†'}
          </button>
          <button class="danger" style="font-size:12px; padding:6px" onclick="deleteLic('${lic.license_key}')">ğŸ—‘ï¸ å½»åº•åœäº§</button>
        </div>
      `;
    grid.appendChild(card);
  });
}

// æœç´¢è¿‡æ»¤
function filterLocalList() {
  const kw = document.getElementById('keywordSearch').value.toLowerCase();
  const filtered = ALL_LICENSES.filter((l) =>
    l.license_key.toLowerCase().includes(kw) ||
    (l.user_name && l.user_name.toLowerCase().includes(kw))
  );
  renderCards(filtered);
}

// ç”Ÿå¡é€»è¾‘
async function doGenerate() {
  const btn = document.getElementById('btnDoGen');
  const pId = document.getElementById('genProductId').value;
  const uName = document.getElementById('genUserName').value;
  const cnt = parseInt(document.getElementById('genCount').value);
  const mD = parseInt(document.getElementById('genMaxDevices').value);
  const dur = document.getElementById('genDuration').value;

  btn.disabled = true; btn.innerText = "âš¡ æ­£åœ¨ç‚¼åˆ¶æ¿€æ´»ç ...";

  try {
    const res = await fetch('/api/v1/auth/admin/generate', {
      method: 'POST',
      headers: { 'Authorization': 'Bearer ' + ADMIN_SECRET, 'Content-Type': 'application/json' },
      body: JSON.stringify({ product_id: pId, user_name: uName, count: cnt, max_devices: mD, duration_days: dur ? parseInt(dur) : null })
    });
    const data = await res.json();
    if (data.success) {
      document.getElementById('genResult').style.display = 'block';
      document.getElementById('genOutput').innerText = data.keys.join('\n');
      renderCards([]); // ç”Ÿå¡åæ¸…ç©ºåˆ—è¡¨æç¤ºåˆ·æ–°
    } else { window.alert(data.msg); }
  } catch (e) { window.alert("é€šè®¯å¤±è´¥: " + e.message); }
  finally { btn.disabled = false; btn.innerText = "âœ¨ ç«‹å³åˆ¶å¡å¹¶æ¿€æ´»è®¢é˜…"; }
}

// API äº¤äº’å‡½æ•°
async function toggleStatus(key, status) {
  if (!window.confirm('ç¡®å®š' + (status === 'active' ? 'æ¢å¤' : 'åŠé”€') + 'å¡å¯†[' + key + ']å—ï¼Ÿ')) return;
  const res = await fetch('/api/v1/auth/admin/licenses/status', {
    method: 'POST',
    headers: { 'Authorization': 'Bearer ' + ADMIN_SECRET, 'Content-Type': 'application/json' },
    body: JSON.stringify({ license_key: key, status })
  });
  if ((await res.json()).success) loadLicenses();
}

async function deleteLic(key) {
  if (!window.confirm('âš ï¸ å±é™©: ç¡®å®šåˆ é™¤å¡å¯†[' + key + ']ï¼Ÿæ­¤æ“ä½œä¸å¯é€†ï¼')) return;
  const res = await fetch('/api/v1/auth/admin/licenses', {
    method: 'DELETE',
    headers: { 'Authorization': 'Bearer ' + ADMIN_SECRET, 'Content-Type': 'application/json' },
    body: JSON.stringify({ license_key: key })
  });
  if ((await res.json()).success) loadLicenses();
}

async function editUserName(key, cur) {
  const n = window.prompt('ä¿®æ”¹ç”¨æˆ·å¤‡æ³¨:', cur);
  if (n === null) return;
  await fetch('/api/v1/auth/admin/licenses/user', {
    method: 'POST',
    headers: { 'Authorization': 'Bearer ' + ADMIN_SECRET, 'Content-Type': 'application/json' },
    body: JSON.stringify({ license_key: key, user_name: n })
  });
  loadLicenses();
}

async function addSub(key) {
  const pId = window.prompt('è¾“å…¥è¦è®¢é˜…çš„äº§å“ ID (å¦‚: smartmp):', 'smartmp');
  if (!pId) return;
  const d = window.prompt('ç»­è´¹å¤©æ•° (è¾“å…¥æ•°å­—, ç•™ç©ºä¸ºæ°¸ä¹…ä¹°æ–­):', '365');
  const res = await fetch('/api/v1/auth/admin/subscriptions', {
    method: 'POST',
    headers: { 'Authorization': 'Bearer ' + ADMIN_SECRET, 'Content-Type': 'application/json' },
    body: JSON.stringify({ license_key: key, product_id: pId, duration_days: d ? parseInt(d) : null })
  });
  const data = await res.json();
  if (data.success) {
    window.alert('ğŸ‰ è®¢é˜…æˆåŠŸ! åˆ°æœŸæ—¥: ' + (data.expires_at || 'æ°¸ä¹…æœ‰æ•ˆ'));
    loadLicenses();
  }
}

function copyText(t) {
  navigator.clipboard.writeText(t);
  const btn = window.event?.currentTarget;
  const old = btn.innerText;
  btn.innerText = 'âœ…';
  setTimeout(() => btn.innerText = old, 1000);
}

function copyGenResult() {
  navigator.clipboard.writeText(document.getElementById('genOutput').innerText);
  window.alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
}
</script>

  </body>
  </html>
    